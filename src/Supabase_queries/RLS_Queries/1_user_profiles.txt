-- Enable RLS on tables one by one
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;

-- Safe SELECT policy - users can see their own profile
CREATE POLICY "Users can view own profile"
ON user_profiles FOR SELECT
USING (
  auth.uid() = auth_user_id OR
  auth.role() = 'service_role'  -- Ensures backend still works
);